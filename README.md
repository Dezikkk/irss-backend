## Features
- passwordless login (magic links)
- async smtp via gmail for magic links  
- jwt tokens are implemented, stateless session
- roles are split: admin (starosta) and regular student
- script to create the first admin (starosta) user is ready
- invites: 
    - to generate starosta invite use `create_invite.py` script
    - starosta can generate invite link for students
- nice project structure (i suppose :3)
- database models and relations are set up

## TODO: What we don't have...

- [ ] Campaign management by the administrator
    - [ ] defining groups and slots
    - [ ] when a campaign is definitively defined, it creates a link for users
    - [ ] editing the number of places in groups
    - [ ] previewing how many people are in a given group
- [ ] Student registration logic
    - [ ] POST /student/register - sends all priorities 
    - [ ] logic to prevent double signups
- [ ] Campaign finish management
    - [ ] assigning students to groups according to their priorities
        - [ ] doing it by random or first come first served roles
    - [ ] generating excel results
- [ ] docker and tests maybe later idk

---

## Project structure
The purpose of each folder in the project tree is the following:
1. `/app`
    - `/models`: SQLModel Python representation of the database tables.
    - `/routes`: Routes for accessing the api.
    - `/serializers`: Models to handle the expected body of the requests.
    - `/core`: Utility functions related to security and whatnot.
2. `/database`: Schematic of DB in picture and dbdiagram.io code


## Running locally
```text
> All you need to do is run script in powershell "run.ps1". 
It will create a virtual enviorment, download all depedencies and start server :D

tip: You can access the auto-generated docs through http://127.0.0.1:8000/docs
It show full list of endpoints and payloads (genuinely useful)
```


## API Endpoints

| method | endpoint | who | what it does |
| :---: | --- | :---: | --- |
| **POST** | `/auth/register-with-invite` | anyone | signup for newbies (u need a code) |
| **POST** | `/auth/request-magic-link` | anyone | login if u have an account (sends the email) |
| **GET** | `/auth/verify` | anyone | the thing u click in email, swaps link for jwt token |
| **GET** | `/users/dashboard` | logged-in | shows ur info & checks if ur admin or student |
| **POST** | `/admin/create-student-invite` | admin | generates the invitation link for student  |
| **GET** | `/student/my-groups` | student | shows ur classes (once we actually build it) |

Detailed description of every endpoint will be avaiable on localhost:8000/docs when i finally write it. Or

---

## Database structure

#### DB Schematic
![alt text](/database/database.png)

#### DB legend
1. `users`: All users (Student/Admin(Starosta)). The role defines permissions.

2. `study_programs`: Majors (np. "Informatyka Rok 1").

3. `invitations`: Invitation codes generated by the Admin (for students) or by a script (for the Admin).

4. `auth_tokens`: “Magic links” for logging in (one-time use).

5. `registration_campaigns`: Registration Campaigns opened by the Admin (e.g., “Rekrutacja zima 2026”).

6. `registration_groups`: Konkretne przedmioty/sloty w ramach kampanii (np. "DevOps gr. 1").

7. `registrations`: Connection between the Student and the Group (registration request). The student's preferences are saved here.
